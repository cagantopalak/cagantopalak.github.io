<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0"/>
<title>Custom New Tab</title>
<style>
  /* === BASIC LAYOUT === */
  *{box-sizing:border-box}html,body{height:100%;margin:0;font-family:sans-serif}
  body{
    background:url('https://images.unsplash.com/photo-1518770660439-4636190af475?auto=format&fit=crop&w=2400&q=80')
               center/cover no-repeat fixed;
    display:flex;align-items:center;justify-content:center
  }
  .container{
    display:grid;grid-template-columns:repeat(auto-fill,120px);gap:20px;
    padding:40px;
    background:rgba(255,255,255,.05);backdrop-filter:blur(10px);
    border-radius:16px;
  }

  /* === TILE === */
  .tile{
    width:120px;height:120px;border-radius:16px;
    background:rgba(255,255,255,.4);display:flex;flex-direction:column;
    align-items:center;justify-content:center;position:relative;
    cursor:grab;transition:.3s
  }
  .tile:hover{background:rgba(255,255,255,.6)}
  .tile img{width:48px;height:48px;margin-bottom:8px}
  .tile span{font-size:13px;text-align:center;padding:0 6px;
             white-space:nowrap;overflow:hidden;text-overflow:ellipsis}

  /* === ACTION BUTTONS === */
  .tile-buttons{position:absolute;top:6px;right:6px;display:flex;gap:5px;opacity:0;transition:.15s}
  .tile:hover .tile-buttons{opacity:1}
  .tile-buttons button{background:none;border:none;font-size:12px;cursor:pointer;color:#333}

  /* === ADD TILE LOOK === */
  .add-tile{font-size:40px;line-height:100px;font-weight:bold;background:rgba(255,255,255,.2)}

  /* === MODAL === */
  .modal{position:fixed;inset:0;display:none;align-items:center;justify-content:center;
         background:rgba(0,0,0,.6)}
  .modal-content{background:#fff;padding:20px;border-radius:12px;min-width:300px;display:flex;flex-direction:column;gap:10px}
  .modal-content input,.modal-content button{padding:8px;font-size:14px}
  .modal-content button{cursor:pointer}
</style>
</head>
<body>
  <div class="container" id="tilesContainer"></div>

  <!-- Modal -->
  <div class="modal" id="siteModal">
    <div class="modal-content">
      <h2 id="modalTitle">Add a Site</h2>
      <input id="siteName"  placeholder="Site Name">
      <input id="siteURL"   placeholder="https://example.com" type="url">
      <input id="siteIcon"  placeholder="Icon URL (optional)" type="url">
      <button id="saveSite">Save</button>
      <button id="cancelSite">Cancel</button>
    </div>
  </div>

<script>
/* ---------------------------  AUDIO BLIPS  --------------------------- */
const AudioCtx = window.AudioContext||window.webkitAudioContext;
const audioCtx = new AudioCtx();

/* Play a quick tone (freq Hz, seconds) */
function playTone(freq, dur){
  if(audioCtx.state==='suspended') audioCtx.resume();
  const osc = audioCtx.createOscillator();
  const gain= audioCtx.createGain();
  osc.frequency.value=freq;
  gain.gain.value=0.06;               // very subtle volume
  osc.connect(gain);gain.connect(audioCtx.destination);
  osc.start();
  gain.gain.exponentialRampToValueAtTime(0.001, audioCtx.currentTime+dur);
  osc.stop(audioCtx.currentTime+dur);
}
const hoverSound = ()=>playTone(500,0.06);  // soft blip
const clickSound = ()=>playTone(180,0.08);  // slightly lower

/* -----------------------  STORAGE & STATE  --------------------------- */
let links = JSON.parse(localStorage.getItem("tiles")||"[]");
let editIndex = null;

/* ELEMENT HANDLES */
const container  = document.getElementById('tilesContainer');
const modal      = document.getElementById('siteModal');
const modalTitle = document.getElementById('modalTitle');
const nameInput  = document.getElementById('siteName');
const urlInput   = document.getElementById('siteURL');
const iconInput  = document.getElementById('siteIcon');
const saveBtn    = document.getElementById('saveSite');
const cancelBtn  = document.getElementById('cancelSite');

/* Helper to fetch favicon */
const favicon = url=>`https://www.google.com/s2/favicons?sz=64&domain_url=${new URL(url).hostname}`;

/* -------------------------- TILE RENDERING --------------------------- */
function renderTiles(){
  container.innerHTML='';
  links.forEach((link,i)=>container.appendChild(buildTile(link,i)));
  container.appendChild(buildAddButton());
}

/* Build a single link tile */
function buildTile({name,url,icon},index){
  const tile=document.createElement('div');
  tile.className='tile'; tile.draggable=true; tile.dataset.index=index;

  tile.innerHTML=`
    <div class="tile-buttons">
      <button onclick="editSite(${index});event.stopPropagation()">âœŽ</button>
      <button onclick="deleteSite(${index});event.stopPropagation()">ðŸ—‘</button>
    </div>
    <a href="${url}" style="text-decoration:none;color:inherit" draggable="false">
      <img src="${icon||favicon(url)}" alt="">
      <span>${name}</span>
    </a>`;

  /* drag events */
  tile.addEventListener('dragstart',dragStart);
  tile.addEventListener('dragover',dragOver);
  tile.addEventListener('drop',drop);

  /* sound events */
  tile.addEventListener('mouseenter',hoverSound,{passive:true});
  tile.addEventListener('mousedown',clickSound,{passive:true});

  return tile;
}

/* Build '+' add button */
function buildAddButton(){
  const btn=document.createElement('div');
  btn.className='tile add-tile';
  btn.textContent='+';
  btn.addEventListener('click',()=>{ openModal(); });
  btn.addEventListener('mouseenter',hoverSound,{passive:true});
  return btn;
}

/* --------------------------  MODAL LOGIC  ---------------------------- */
function openModal(edit=false){
  modal.style.display='flex';
  modalTitle.textContent=edit?'Edit Site':'Add a Site';
  if(!edit){
    nameInput.value=urlInput.value=iconInput.value='';
    editIndex=null;
  }
  nameInput.focus();
}
function closeModal(){ modal.style.display='none'; }

saveBtn.onclick = ()=>{
  const name=nameInput.value.trim(), url=urlInput.value.trim(), icon=iconInput.value.trim();
  if(!name||!url) return;
  const entry={name,url,icon};
  if(editIndex!==null) links[editIndex]=entry; else links.push(entry);
  persist();
  closeModal();
};
cancelBtn.onclick=closeModal;
window.addEventListener('keydown',e=>{ if(e.key==='Escape') closeModal(); });

/* ----------------------  EDIT / DELETE / DRAG  ----------------------- */
window.editSite = idx=>{
  const link=links[idx];
  nameInput.value=link.name; urlInput.value=link.url; iconInput.value=link.icon||'';
  editIndex=idx; openModal(true);
};
window.deleteSite = idx=>{
  if(!confirm('Delete this tile?')) return;
  links.splice(idx,1); persist();
};

/* dragâ€‘andâ€‘drop order */
let dragStartIndex;
function dragStart(e){ dragStartIndex=+this.dataset.index; e.dataTransfer.effectAllowed='move'; }
function dragOver(e){
  e.preventDefault();
  const overIndex=+this.dataset.index;
  if(dragStartIndex===overIndex) return;
  const moved=links.splice(dragStartIndex,1)[0];
  links.splice(overIndex,0,moved);
  dragStartIndex=overIndex;
  persist(false); // don't play flash reâ€‘render too often
}
function drop(e){ e.preventDefault(); renderTiles(); }

/* ------------------------------ UTIL ------------------------------- */
function persist(rerender=true){
  localStorage.setItem('tiles',JSON.stringify(links));
  if(rerender) renderTiles();
}

/* -------------------------- INITIALISE ---------------------------- */
renderTiles();
</script>
</body>
</html>
